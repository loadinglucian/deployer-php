---
alwaysApply: false
---

# Rules for Writing Rules

Guidelines for creating and maintaining rule files optimized for AI agents with limited token windows.

## Token Efficiency Principles

- Use imperative mood, not conversational prose
- One example per pattern maximum
- Remove "Benefits", "Why This Matters", "Key Benefits" sections
- Use inline comments over separate explanations
- Use bullets over paragraphs
- Single "All rules MANDATORY" statement per file
- No repetitive CRITICAL/IMMUTABLE warnings
- No emoji in headers (wastes tokens, no AI value)

## Structure Standards

**File Header:**

```yaml
---
alwaysApply: true
---
## [Section Name]

All rules MANDATORY unless marked optional.
```

**Section Organization:**

- Clear, scannable headers
- Related rules grouped together
- Alphabetical ordering when no logical grouping exists
- No more than 3 heading levels

## Example Guidelines

**Pattern: Show correct first, wrong only when non-obvious**

```php
// ✅ CORRECT
$result = $container->build(Service::class);

// ❌ WRONG - manual instantiation breaks DI
$result = new Service(new Dependency());
```

**Rules:**

- Keep examples under 10 lines
- Use `// ✅ CORRECT` and `// ❌ WRONG` markers consistently
- Prefer inline comments to prose explanations
- Remove examples for well-known patterns (AAA, SOLID, etc.)
- Don't explain framework features (Laravel Prompts, Pest, Symfony)

## Cross-File Coordination

**Avoid Duplication:**

- Single source of truth per concept
- If rule appears in multiple contexts, pick primary location
- Cross-reference by filename only: "See 03-commands.mdc"
- No line number references (brittle)

**Valid Cross-References:**

```markdown
See [ServerValidationTrait.php](mdc:app/Traits/ServerValidationTrait.php)
Covered in 03-commands.mdc
```

**Verify Links:**

- All `mdc://` references must point to existing files
- Remove references to deleted files immediately

## Maintenance Checklist

Before committing rule changes:

1. Remove outdated file references
2. Check for duplication with other rule files
3. Verify no contradictions introduced
4. Test that code examples compile/run
5. Run token count comparison (target: 35-65% of original verbosity)
6. Confirm critical rules still emphasized (but not repetitively)

## Anti-Patterns

**Avoid:**

- Copying third-party documentation verbatim (summarize key points only)
- Multiple examples showing identical patterns
- Teaching language/framework fundamentals
- Explaining obvious concepts
- Tables where bullet lists suffice
- Conversational explanations of patterns shown in code

**Example - Too Verbose:**

```markdown
**How It Works:**

1. Container analyzes constructor via reflection
2. Recursively builds dependencies
3. Caches reflection data
4. Handles errors gracefully

**Key Benefits:**

- Zero configuration required
- Type-safe with generics
- Easy testing with mocks
```

**Example - Optimized:**

```markdown
Use `$container->build(Class::class)` for all object creation.
Exceptions: DTOs, value objects, pure data structures.
```

## Token Budget Awareness

- AI agents may have 8K-32K context windows
- Rules should consume <20% of available tokens
- Leave 80% for code, history, and responses
- Total rule corpus target: <3000 tokens (~600-800 lines)

## Writing Style

**Prefer:**

```markdown
Commands handle user I/O. Services contain business logic. No circular dependencies.
```

**Over:**

```markdown
Commands are responsible for handling all user interaction including input and output operations, while Services provide the core business logic functionality. It's important to note that circular dependencies between these layers are not allowed and should be avoided at all costs.
```

**Emphasis Hierarchy:**

1. Code examples (most efficient)
2. Imperative bullets
3. Short declarative sentences
4. Tables (only for reference data)
5. Prose explanations (last resort)
