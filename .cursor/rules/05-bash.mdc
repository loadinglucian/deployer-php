---
alwaysApply: true
---

## Bash Style

All rules MANDATORY. Based on https://style.ysap.sh/md

### Core Syntax

**Conditionals:** Use `[[ ... ]]` not `[ ... ]` or `test`

```bash
[[ -d /etc ]]              # ✅ CORRECT
[ -d /etc ]                # ❌ WRONG
```

**Command Substitution:** Use `$(...)` not backticks

```bash
foo=$(date)                # ✅ CORRECT
foo=`date`                 # ❌ WRONG
```

**Math:** Use `((...))` and `$((...))`, never `let`

```bash
if ((a > b)); then ...     # ✅ CORRECT
if [[ $a -gt $b ]]; then   # ❌ WRONG - use math syntax for comparisons
```

**Functions:** No `function` keyword, always use `local` for variables

```bash
foo() { local i=5; }       # ✅ CORRECT
function foo { i=5; }      # ❌ WRONG - global variable, function keyword
```

**Block Statements:** `then` same line as `if`, `do` same line as `while`

```bash
if true; then ...          # ✅ CORRECT
while true; do ...         # ✅ CORRECT
```

### Parameter Handling

**Expansion:** Prefer parameter expansion over external commands

```bash
prog=${0##*/}              # ✅ CORRECT - basename
nonumbers=${name//[0-9]/}  # ✅ CORRECT - remove numbers
prog=$(basename "$0")      # ❌ WRONG - external command
```

**Quoting:** Double quotes for expansions, single for literals

```bash
echo "$foo"                # ✅ CORRECT - expansion needs quotes
bar='literal'              # ✅ CORRECT - no expansion
if [[ -n $foo ]]; then     # ✅ CORRECT - [[ ... ]] doesn't word-split
```

Exception: Variables controlled by script (not user input) may be unquoted in `[[ ... ]]`

**Arrays:** Use bash arrays, not space-separated strings

```bash
modules=(a b c)            # ✅ CORRECT
for m in "${modules[@]}"   # ✅ CORRECT - quoted array expansion
modules='a b c'            # ❌ WRONG - string not array
```

### Error Handling

**Check commands that can fail:**

```bash
cd /path || exit           # ✅ CORRECT - exit on failure
cd /path                   # ❌ WRONG - what if cd fails?
rm file
```

**Pipeline errors:** Use `set -o pipefail` in playbooks

**Don't use `set -e`:** Explicit error checking preferred over errexit

**Never use `eval`:** Security risk, static analysis impossible

### File Operations

**Reading files:** Use redirection or built-in read

```bash
while IFS=: read -r user _; do
    echo "$user"
done < /etc/passwd         # ✅ CORRECT - streaming

grep foo file              # ✅ CORRECT
cat file | grep foo        # ❌ WRONG - useless use of cat
```

**Listing files:** Never parse `ls`, use globs

```bash
for f in *; do ...         # ✅ CORRECT
for f in $(ls); do ...     # ❌ WRONG - unsafe
```

### Formatting

- Tabs for indentation
- Max 80 columns
- Semicolons only in control statements (`if true; then`)
- Max 1 blank line between sections
- Shebang: `#!/usr/bin/env bash`
